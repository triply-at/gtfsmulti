<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2. Multi-modal routing with a GTFS-Multi feed • gtfsmulti</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="2. Multi-modal routing with a GTFS-Multi feed">
<meta property="og:description" content="gtfsmulti">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">gtfsmulti</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/website_only/01_intro.html">1. Introducing the GTFS-Multi format</a>
    </li>
    <li>
      <a href="../../articles/website_only/02_route.html">2. Multi-modal routing with a GTFS-Multi feed</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="02_route_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="02_route_files/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="02_route_files/jquery-1.12.4/jquery.min.js"></script><link href="02_route_files/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="02_route_files/leaflet-1.3.1/leaflet.js"></script><link href="02_route_files/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="02_route_files/proj4-2.6.2/proj4.min.js"></script><script src="02_route_files/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="02_route_files/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="02_route_files/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="02_route_files/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="02_route_files/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script><link href="02_route_files/HomeButton-0.0.1/home-button.css" rel="stylesheet">
<script src="02_route_files/HomeButton-0.0.1/home-button.js"></script><script src="02_route_files/HomeButton-0.0.1/easy-button-src.min.js"></script><script src="02_route_files/clipboard-0.0.1/setClipboardText.js"></script><link href="02_route_files/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet">
<link href="02_route_files/mapviewCSS-0.0.1/mapview.css" rel="stylesheet">
<script src="02_route_files/travel%20time%20(s)_fa0e24-1/data_stars_traveltimesf6803c.txt"></script><script src="02_route_files/joda-0.0.1/joda.js"></script><script src="02_route_files/joda-0.0.1/addImageQuery-bindings.js"></script><script src="02_route_files/travel%20time%20(s)_72e946-1/data_stars_traveltimesa07d2e.txt"></script><script src="02_route_files/travel%20time%20(s)_dc31e7-1/data_stars_traveltimesed4237.txt"></script><script src="02_route_files/travel%20time%20(s)_7a6ce1-1/data_stars_traveltimes7b2150.txt"></script><script src="02_route_files/travel%20time%20(s)_d81b6c-1/data_stars_traveltimes8d6124.txt"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>2. Multi-modal routing with a GTFS-Multi feed</h1>
                        <h4 data-toc-skip class="author">Lucas van der Meer, triply GmbH</h4>
            
            <h4 data-toc-skip class="date">2021-12-20</h4>
      
      
      <div class="hidden name"><code>02_route.Rmd</code></div>

    </div>

    
    
<p>The <code>gtfsmulti</code> package implements a very experimental approach to creating, storing and analyzing multi-modal transportation networks. The first vignette introduced the GTFS-Multi format and showed how to construct, read and write one. In this vignette we will show how to calculate multi-modal routes with a GTFS-Multi feed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gtfsmulti</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/mapview" class="external-link">mapview</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></code></pre></div>
<div class="section level2">
<h2 id="getting-the-data">Getting the data<a class="anchor" aria-label="anchor" href="#getting-the-data"></a>
</h2>
<p>The GTFS-Multi feed for the city center of Tampere, created in the first vignette, is included in the package as an object called <code>tampere</code>. It is of class <code>multinet</code> and contains all required datasets of a GTFS-Multi feed.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tampere</span><span class="op">)</span>
<span class="co">#&gt;  [1] "calendar_dates" "agency"         "stop_times"     "routes"        </span>
<span class="co">#&gt;  [5] "transfers"      "calendar"       "trips"          "stops"         </span>
<span class="co">#&gt;  [9] "grid"           "access"         "direct"         "egress"</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">tampere</span><span class="op">)</span>
<span class="co">#&gt; [1] "multinet" "gtfs"     "list"</span></code></pre></div>
<p>In addition, we will read the reference grid that was used to build this feed. Such a grid will usually be stored as a GeoTIFF file alongside the feed itself. We have it included as external package data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grid</span> <span class="op">=</span> <span class="fu"><a href="../../reference/import_grid.html">import_grid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"tampere.geotiff"</span>, package <span class="op">=</span> <span class="st">"gtfsmulti"</span><span class="op">)</span><span class="op">)</span>
<span class="va">grid</span>
<span class="co">#&gt; stars object with 2 dimensions and 1 attribute</span>
<span class="co">#&gt; attribute(s):</span>
<span class="co">#&gt;                  Min. 1st Qu. Median Mean 3rd Qu. Max. NA's</span>
<span class="co">#&gt; tampere.geotiff     1       1      1    1       1    1  859</span>
<span class="co">#&gt; dimension(s):</span>
<span class="co">#&gt;   from to  offset delta                refsys point values x/y</span>
<span class="co">#&gt; x    1 50  325200   100 ETRS89 / TM35FIN(E,N) FALSE   NULL [x]</span>
<span class="co">#&gt; y    1 50 6824850  -100 ETRS89 / TM35FIN(E,N) FALSE   NULL [y]</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setting-the-origin-location-and-start-time-limits">Setting the origin location and start time limits<a class="anchor" aria-label="anchor" href="#setting-the-origin-location-and-start-time-limits"></a>
</h2>
<p>Routes will always be calculated from a single origin to all possible destinations. In practice, this means that the given origin point is first snapped to its nearest grid point, and that from that grid points shortest routes are found to all other grid points. The coordinates of the origin location are supposed to be expressed as longitude and latitude values in coordinate reference system <a href="https://epsg.io/4326" class="external-link">EPSG:4326</a>.</p>
<p>Lets set an origin location somewhere in downtown Tampere:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">origin</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">23.761215</span>, <span class="fl">61.496725</span><span class="op">)</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></code></pre></div>
<p>Internally the function <code><a href="../../reference/get_nearest_neighbour.html">get_nearest_neighbour()</a></code> is used to find the nearest grid point in the GTFS-Multi feed to such an origin location. It returns the index of this grid point as well as the distance in meters between the origin location and the grid point. But as said, this is all done internally.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coords</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">origin</span><span class="op">)</span>
<span class="fu"><a href="../../reference/get_nearest_neighbour.html">get_nearest_neighbour</a></span><span class="op">(</span><span class="va">coords</span>, <span class="va">tampere</span><span class="op">$</span><span class="va">grid</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stop_id"</span>, <span class="st">"stop_lon"</span>, <span class="st">"stop_lat"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; $idx</span>
<span class="co">#&gt; [1] "I25J25"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dist</span>
<span class="co">#&gt; [1] 30.22641</span></code></pre></div>
<p>In addition we should define at which time a trip is allowed to start. You can set this as a time interval with an upper and lower bound. The time instants should be given as seconds since midnight. In our examples we will use a time interval between 8:00 AM and 9:00 AM. That is, a trip may start at any time during this time interval. We should also define during which day of the week we want to calculate travel times, as transit timetables may be different between days (if we don’t set this automatically the current day is taken).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">time</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span> <span class="op">*</span> <span class="fl">3600</span>, <span class="fl">9</span> <span class="op">*</span> <span class="fl">3600</span><span class="op">)</span>
<span class="va">day</span> <span class="op">=</span> <span class="st">"Monday"</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="finding-the-shortest-travel-time">Finding the shortest travel time<a class="anchor" aria-label="anchor" href="#finding-the-shortest-travel-time"></a>
</h2>
<p>The standard approach is to calculate the shortest possible travel time of a trip between an origin and a destination given that the trip should start somewhere in the given time interval. In <code>gtfsmulti</code>, the <code><a href="../../reference/multinet_traveltimes.html">multinet_traveltimes()</a></code> function is the core multi-modal routing function. It calculates door-to-door travel times that take into account all different parts of a multi-modal trip. The calculation steps are the following:</p>
<ol style="list-style-type: decimal">
<li>The nearest grid point to the given origin location is found. An imaginary pre-leg of the trip accounts to some extent for the distance between these two points. This distance (as-the-crow-flies) is assumed to be travelled at a fixed speed, specified in the <code>grid_access_speed</code> parameter. By default its value is set to a walking-like speed of 5 / 3.6 m/s, i.e. 5 km/h. When setting <code>include_grid_access = FALSE</code> the distance between the actual origin location and its nearest grid point is not accounted for and the trip is assumed to effectively start at the nearest grid point. Keep again in mind that no matter what approach you choose, results get less accurate with a coarser grid.</li>
<li>For each transit stop listed in the <em>stops table</em> of the GTFS-Multi feed, the shortest multi-modal travel time from the selected grid point to that stop is calculated. This is done by a purely timetable-based routing algorithm. Access trips listed in the <em>access table</em> of the GTFS-Multi feed that originate from the selected grid point are included in the transit timetable by modelling them as direct transit trips from the selected grid point towards reachable transit stops, operating on a frequency-based schedule. The frequency of these trips is defined by the <code>access_frequency</code> parameter, which by default is set to 60 seconds, i.e. one departure every minute. The length of such an access trip is the minimum travel time for a given access connection among all different modes that are present in the access table. The modes can be filtered by setting the <code>access_modes</code> parameter, e.g. <code>access_modes = "walk"</code> to include only access times by foot. Possible trips itself may be filtered as well, by setting a maximum allowed travel time through the <code>access_limit</code> parameter. During the transit leg of the trip it is possible to transfer from one vehicle to another using a transfer connection listed in the <em>transfers table</em> of the GTFS-Multi feed. The travel time of such a transfer connection is the minimum travel time among all different modes that are present in the transfer table. The modes can be filtered by setting the <code>transfer_modes</code> parameter, e.g. <code>transfer_modes = "walk"</code> to include only transfer times by foot. Possible trips itself may be filtered as well, by setting a maximum allowed travel time through the <code>transfer_limit</code> parameter. For efficiency reasons, the routing algorithm in this phase has an upper bound defined, meaning that if the cumulative travel time of a trip from the selected grid point exceeds this upper bound before the transit stop is reached, the search for a route to that stop is terminated and the transit stop is marked as unreachable. This upper bound can be defined through the <code>router_timeout</code> parameter and defaults to 60 * 60 seconds, i.e. 1 hour.</li>
<li>For each destination grid point (i.e. all grid points except the one selected as origin) listed in the <em>grid table</em> of the GTFS-Multi feed, multi-modal travel times from the selected origin grid point to that destination grid point are calculated. This is done by extracting travel times of egress trips that lead to the destination grid point from the <em>egress table</em> of the GTFS-Multi feed, and adding those to the travel times from the origin grid point towards transit stops as calculated in the previous step. For a destination grid point this will often result in a set of multiple travel times (since there may be multiple egress trips leading to the same grid point), of which only the shortest one is preserved. The travel time of an egress connection is the minimum travel time among all different modes that are present in the egress table. The modes can be filtered by setting the <code>egress_modes</code> parameter, e.g. <code>egress_modes = "walk"</code> to include only egress times by foot. Possible trips itself may be filtered as well, by setting a maximum allowed travel time through the <code>egress_limit</code> parameter.</li>
<li>For each destination grid point listed in the <em>grid table</em> of the GTFS-Multi feed, the shortest multi-modal travel time (as calculated in the step above) is compared to the travel time of a single-modal direct trip listed in the <em>direct table</em> of the GTFS-Multi feed. The travel time of such a direct connection is the minimum travel time among all different modes that are present in the direct table. The modes can be filtered by setting the <code>direct_modes</code> parameter, e.g. <code>direct_modes = "bike"</code> to include only direct times by bicycle. Possible trips itself may be filtered as well, by setting a maximum allowed travel time through the <code>direct_limit</code> parameter. The minimum between the multi-modal travel times and the single-modal travel time is the returned shortest travel time from the selected origin grid point to the destination grid point.</li>
</ol>
<p>Since all access, egress, direct and transfer times are already pre-calculated and stored in the GTFS Multi-feed, there is no street network routing needed anymore at this stage. The multi-modal travel times are calculated with a purely timetable-based routing algorithm. For that, <code><a href="../../reference/multinet_traveltimes.html">multinet_traveltimes()</a></code> relies on <code><a href="https://rdrr.io/pkg/gtfsrouter/man/gtfs_traveltimes.html" class="external-link">gtfsrouter::gtfs_traveltimes()</a></code>, a function from the great <a href="https://github.com/ATFutures/gtfs-router" class="external-link">gtfsrouter</a> package that implements a recently developed algorithm for efficient one-to-many routing in transit networks.</p>
<p>An example:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">short</span> <span class="op">=</span> <span class="fu"><a href="../../reference/multinet_traveltimes.html">multinet_traveltimes</a></span><span class="op">(</span><span class="va">tampere</span>, <span class="va">origin</span>, <span class="va">time</span>, day <span class="op">=</span> <span class="va">day</span>, egress_modes <span class="op">=</span> <span class="st">"walk"</span><span class="op">)</span>
<span class="va">short</span>
<span class="co">#&gt;       stop_id row_id col_id        stop_name stop_lat stop_lon travel_time</span>
<span class="co">#&gt;    1:   I39J4     39      4  Grid cell I39J4 61.51618 23.78610   1110.9811</span>
<span class="co">#&gt;    2:   I34J5     34      5  Grid cell I34J5 61.51506 23.77681    972.9811</span>
<span class="co">#&gt;    3:   I35J5     35      5  Grid cell I35J5 61.51511 23.77868   1025.9811</span>
<span class="co">#&gt;    4:   I36J5     36      5  Grid cell I36J5 61.51515 23.78056    929.9811</span>
<span class="co">#&gt;    5:   I37J5     37      5  Grid cell I37J5 61.51520 23.78244    947.9811</span>
<span class="co">#&gt;   ---                                                                     </span>
<span class="co">#&gt; 1637:  I46J50     46     50 Grid cell I46J50 61.47526 23.80347   1476.9811</span>
<span class="co">#&gt; 1638:  I47J50     47     50 Grid cell I47J50 61.47530 23.80534   1441.9811</span>
<span class="co">#&gt; 1639:  I48J50     48     50 Grid cell I48J50 61.47535 23.80722   1380.9811</span>
<span class="co">#&gt; 1640:  I49J50     49     50 Grid cell I49J50 61.47539 23.80909   1509.9811</span>
<span class="co">#&gt; 1641:  I50J50     50     50 Grid cell I50J50 61.47544 23.81096   1592.9811</span></code></pre></div>
<p>As can be seen the function returns the grid table of the GTFS-Multi feed, with an additional column containing for each grid point the shortest travel time between the given origin location and that grid point. Grid points that could not be reached get assigned a travel time of <code>NA</code>.</p>
<p>We can use <code><a href="../../reference/create_traveltime_grid.html">create_traveltime_grid()</a></code> to write these travel times as values to the pixels of the reference grid. Such travel time grids are easy to visualize, and later on it will be easy to combine them for example with data about population, jobs or service locations in order to calculate accessibility metrics.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">short_grid</span> <span class="op">=</span> <span class="fu"><a href="../../reference/create_traveltime_grid.html">create_traveltime_grid</a></span><span class="op">(</span><span class="va">short</span>, <span class="va">grid</span><span class="op">)</span>
<span class="va">short_grid</span>
<span class="co">#&gt; stars object with 2 dimensions and 1 attribute</span>
<span class="co">#&gt; attribute(s):</span>
<span class="co">#&gt;                  Min.  1st Qu.   Median     Mean  3rd Qu.     Max. NA's</span>
<span class="co">#&gt; travel_time  161.9811 382.2311 567.4811 596.7634 767.9811 2493.981  906</span>
<span class="co">#&gt; dimension(s):</span>
<span class="co">#&gt;   from to  offset delta                refsys point values x/y</span>
<span class="co">#&gt; x    1 50  325200   100 ETRS89 / TM35FIN(E,N) FALSE   NULL [x]</span>
<span class="co">#&gt; y    1 50 6824850  -100 ETRS89 / TM35FIN(E,N) FALSE   NULL [y]</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Remove outliers for clearer visualization.</span>
<span class="va">drop_outliers</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="va">x</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">x</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fl">0.95</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span>; <span class="va">x</span> <span class="op">}</span>
<span class="va">short_grid</span> <span class="op">=</span> <span class="fu">drop_outliers</span><span class="op">(</span><span class="va">short_grid</span><span class="op">)</span>

<span class="co"># Get bounding box of reference grid.</span>
<span class="va">bbox</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span><span class="va">bbox</span>, alpha.regions <span class="op">=</span> <span class="fl">0</span>, alpha <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span><span class="va">short_grid</span>, layer.name <span class="op">=</span> <span class="st">"travel time (s)"</span>, na.color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span><span class="va">origin</span>, col.regions <span class="op">=</span> <span class="st">"black"</span>, alpha.regions <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0</span>, cex  <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-aaaff46c93a695a0169d" style="width:672px;height:384px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-aaaff46c93a695a0169d">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addPolygons","args":[[[[{"lng":[23.718250126641,23.8119475380217,23.8073542116148,23.713522385386,23.718250126641],"lat":[61.4727836102293,61.475009038068,61.5198256633383,61.5175961006981,61.4727836102293]}]]],null,"bbox",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":"#333333","weight":3,"opacity":1,"fill":true,"fillColor":"#6666ff","fillOpacity":0,"smoothFactor":1,"noClip":false},null,{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},"1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":5,"opacity":1,"fillOpacity":0,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[23.713522385386,61.4727836102293,23.8119475380217,61.5198256633383,true,"bbox","Zoom to bbox","<strong> bbox <\/strong>","bottomright"]},{"method":"addRasterImage","args":["data:image/png;base64,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",[[61.5198256633382,23.713522385386],[61.472299651963,23.8131118965579]],0.8,null,"travel time (s)","travel time (s)"]},{"method":"removeLayersControl","args":[]},{"method":"addControl","args":["","topright","imageValues-travel time (s)","info legend "]},{"method":"addImageQuery","args":["travel time (s)",[23.713522385386,61.4717972390467,23.8134734305333,61.5198256633382],"mousemove",7,"Layer"]},{"method":"addLegend","args":[{"colors":["#040404 , #0F0D25 4.16417059332314%, #37134A 15.1170731124907%, #661165 26.0699756316583%, #941473 37.0228781508259%, #BE2C72 47.9757806699935%, #E14F5C 58.928683189161%, #F47D2A 69.8815857083286%, #F7AD31 80.8344882274962%, #F9DA6B 91.7873907466638%, #FFFE9E "],"labels":["200","300","400","500","600","700","800","900","1,000"],"na_color":"#FFFFFF","na_label":"NA","opacity":1,"position":"topright","type":"numeric","title":"travel time (s)","extra":{"p_1":0.0416417059332314,"p_n":0.917873907466638},"layerId":null,"className":"info legend","group":"travel time (s)"}]},{"method":"addHomeButton","args":[23.713522385386,61.4727836102293,23.8119475380217,61.5198256633383,true,"travel time (s)","Zoom to travel time (s)","<strong> travel time (s) <\/strong>","bottomright"]},{"method":"createMapPane","args":["point",440]},{"method":"addCircleMarkers","args":[61.496725,23.761215,3,null,"origin",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"point","stroke":true,"color":"#333333","weight":1,"opacity":0,"fill":true,"fillColor":"black","fillOpacity":1},null,null,null,{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},"1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addHomeButton","args":[23.761215,61.496725,23.761215,61.496725,true,"origin","Zoom to origin","<strong> origin <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],["bbox","travel time (s)","origin"],{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addHomeButton","args":[23.713522385386,61.472299651963,23.8131118965579,61.5198256633383,true,null,"Zoom to full extent","<strong>Zoom full<\/strong>","bottomleft"]}],"limits":{"lat":[61.4727836102293,61.5198256633383],"lng":[23.713522385386,23.8119475380217]},"fitBounds":[61.472299651963,23.713522385386,61.5198256633383,23.8131118965579,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script><p>Travel time grids can be imported and exported from/to GeoTIFF files using respectively the <code><a href="../../reference/import_grid.html">import_grid()</a></code> and <code><a href="../../reference/export_grid.html">export_grid()</a></code> functions.</p>
</div>
<div class="section level2">
<h2 id="doing-it-the-r5-way">Doing it the R5 way<a class="anchor" aria-label="anchor" href="#doing-it-the-r5-way"></a>
</h2>
<p>The shortest possible travel time is not always a good metric to evaluate the quality of transit accessibility, because it does not tell you anything about the frequency of the service. There might be a very good bus connection that only operates once a day. When reporting only the shortest travel time to a destination along this connection the transit accessibility will be evaluated as being of very high quality. However, most of the day you might be hardly able to reach your destination by transit within an acceptable travel time. Hence, frequency is an important evaluation measure as well.</p>
<p>That is the reason why <a href="https://docs.conveyal.com/analysis/methodology" class="external-link">Conveyal</a> with their R5 routing engine takes a different approach to travel time calculations. They calculate the travel time of multi-modal trips from a given origin to all destinations with a <em>fixed</em> start time. They iteratively repeat that calculation for <em>every minute</em> within the window of allowed starting times. In that way they obtain a distribution of travel times, which allows to analyze frequency of service.</p>
<p>Using <code><a href="../../reference/multinet_traveltimes.html">multinet_traveltimes()</a></code> you can do the same by setting <code>iterate = TRUE</code>. This will run the travel time calculation explained in the previous section iteratively, and during each iteration fixing the start time of the trips by forwarding a time period that has the same upper as lower bound. The start times that are iterated over are defined by the <code>access_frequency</code> parameter. By default this is set to 60 seconds, i.e. every minute.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all</span> <span class="op">=</span> <span class="fu"><a href="../../reference/multinet_traveltimes.html">multinet_traveltimes</a></span><span class="op">(</span>
  <span class="va">tampere</span>,
  <span class="va">origin</span>,
  <span class="va">time</span>,
  day <span class="op">=</span> <span class="va">day</span>,
  egress_modes <span class="op">=</span> <span class="st">"walk"</span>,
  iterate <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">all</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"travel_time"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">all</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt;  [1] "travel_time_28800" "travel_time_28860" "travel_time_28920"</span>
<span class="co">#&gt;  [4] "travel_time_28980" "travel_time_29040" "travel_time_29100"</span>
<span class="co">#&gt;  [7] "travel_time_29160" "travel_time_29220" "travel_time_29280"</span>
<span class="co">#&gt; [10] "travel_time_29340" "travel_time_29400" "travel_time_29460"</span>
<span class="co">#&gt; [13] "travel_time_29520" "travel_time_29580" "travel_time_29640"</span>
<span class="co">#&gt; [16] "travel_time_29700" "travel_time_29760" "travel_time_29820"</span>
<span class="co">#&gt; [19] "travel_time_29880" "travel_time_29940" "travel_time_30000"</span>
<span class="co">#&gt; [22] "travel_time_30060" "travel_time_30120" "travel_time_30180"</span>
<span class="co">#&gt; [25] "travel_time_30240" "travel_time_30300" "travel_time_30360"</span>
<span class="co">#&gt; [28] "travel_time_30420" "travel_time_30480" "travel_time_30540"</span>
<span class="co">#&gt; [31] "travel_time_30600" "travel_time_30660" "travel_time_30720"</span>
<span class="co">#&gt; [34] "travel_time_30780" "travel_time_30840" "travel_time_30900"</span>
<span class="co">#&gt; [37] "travel_time_30960" "travel_time_31020" "travel_time_31080"</span>
<span class="co">#&gt; [40] "travel_time_31140" "travel_time_31200" "travel_time_31260"</span>
<span class="co">#&gt; [43] "travel_time_31320" "travel_time_31380" "travel_time_31440"</span>
<span class="co">#&gt; [46] "travel_time_31500" "travel_time_31560" "travel_time_31620"</span>
<span class="co">#&gt; [49] "travel_time_31680" "travel_time_31740" "travel_time_31800"</span>
<span class="co">#&gt; [52] "travel_time_31860" "travel_time_31920" "travel_time_31980"</span>
<span class="co">#&gt; [55] "travel_time_32040" "travel_time_32100" "travel_time_32160"</span>
<span class="co">#&gt; [58] "travel_time_32220" "travel_time_32280" "travel_time_32340"</span>
<span class="co">#&gt; [61] "travel_time_32400"</span></code></pre></div>
<p>As can be seen the function returns still returns the grid table of the GTFS-Multi feed, but now with many additional columns containing for each grid point the shortest travel time between the given origin location and that grid point fixed at a given start time. Since we used a time interval of 1 hour with an access frequency of 1 minute, we obtain 61 different travel time values for each grid point. If we want a lower level of detail to gain performance, we can change the value of the <code>access_frequency</code> parameter, e.g. to every 10 minutes.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">few</span> <span class="op">=</span> <span class="fu"><a href="../../reference/multinet_traveltimes.html">multinet_traveltimes</a></span><span class="op">(</span>
  <span class="va">tampere</span>,
  <span class="va">origin</span>,
  <span class="va">time</span>,
  day <span class="op">=</span> <span class="va">day</span>,
  egress_modes <span class="op">=</span> <span class="st">"walk"</span>,
  iterate <span class="op">=</span> <span class="cn">TRUE</span>,
  access_frequency <span class="op">=</span> <span class="fl">600</span>
<span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">few</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"travel_time"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">few</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt; [1] "travel_time_28800" "travel_time_29400" "travel_time_30000"</span>
<span class="co">#&gt; [4] "travel_time_30600" "travel_time_31200" "travel_time_31800"</span>
<span class="co">#&gt; [7] "travel_time_32400"</span></code></pre></div>
<p>The travel time grid we create with all these calculated travel times has an additional dimension next to the two spatial dimensions. This <em>time</em> dimension has one coordinate per iterated start time.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_grid</span> <span class="op">=</span> <span class="fu"><a href="../../reference/create_traveltime_grid.html">create_traveltime_grid</a></span><span class="op">(</span><span class="va">all</span>, <span class="va">grid</span><span class="op">)</span>
<span class="va">all_grid</span>
<span class="co">#&gt; stars object with 3 dimensions and 1 attribute</span>
<span class="co">#&gt; attribute(s):</span>
<span class="co">#&gt;                  Min.  1st Qu.   Median     Mean  3rd Qu.     Max.  NA's</span>
<span class="co">#&gt; travel_time  161.9811 607.9811 867.9811 884.3045 1132.981 4113.981 55270</span>
<span class="co">#&gt; dimension(s):</span>
<span class="co">#&gt;      from to  offset delta                refsys point values x/y</span>
<span class="co">#&gt; x       1 50  325200   100 ETRS89 / TM35FIN(E,N) FALSE   NULL [x]</span>
<span class="co">#&gt; y       1 50 6824850  -100 ETRS89 / TM35FIN(E,N) FALSE   NULL [y]</span>
<span class="co">#&gt; time    1 61   28800    60                    NA    NA   NULL</span></code></pre></div>
<p>Following the Conveyal approach, we can reduce this full distribution of travel time values to a set of given <a href="https://docs.conveyal.com/analysis/methodology#time-percentile" class="external-link">percentile</a> values. Different percentile values represent different views on what high quality transit accessibility means. For example, for a certain destination, the value of the travel time distribution at a percentile value close to 0 will be similar to the shortest possible travel time towards this destination during the given interval. It is appropriate for people that are flexible enough to fit their time schedule of travel to the transit time schedule, and thus don’t care too much about the frequency of the service. At the other side, the value of the travel time distribution at a percentile value close to 100 gives the time it will <em>at least</em> take you to reach the origin. It is appropriate for people that want to be able to leave at anytime, not even knowing the exact transit schedule. To get a balance between these two extremes, you may use any percentile value in between 0 and 100.</p>
<p>The <code><a href="../../reference/reduce_to_percentiles.html">reduce_to_percentiles()</a></code> function lets you reduce a dense travel time grid to, for each pixel, a set of travel times at different percentile values of the full distribution. You can choose as many percentile values as you want. The result is a travel time grid in which the original <em>time</em> dimension is replaced by a <em>percentile</em> dimension, with one coordinate per selected percentile value.</p>
<blockquote>
<p><strong>NOTE</strong> You can also call <code><a href="../../reference/reduce_to_percentiles.html">reduce_to_percentiles()</a></code> directly on the expanded grid table returned by <code><a href="../../reference/multinet_traveltimes.html">multinet_traveltimes()</a></code>. This will replace the original travel time columns by travel time percentile columns.</p>
</blockquote>
<p>An example:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">prc_grid</span> <span class="op">=</span> <span class="fu"><a href="../../reference/reduce_to_percentiles.html">reduce_to_percentiles</a></span><span class="op">(</span><span class="va">all_grid</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">95</span><span class="op">)</span><span class="op">)</span>
<span class="va">prc_grid</span>
<span class="co">#&gt; stars object with 3 dimensions and 1 attribute</span>
<span class="co">#&gt; attribute(s):</span>
<span class="co">#&gt;                  Min.  1st Qu.   Median     Mean  3rd Qu.     Max. NA's</span>
<span class="co">#&gt; travel_time  161.9811 573.9811 828.9811 892.8773 1162.981 4053.981 1812</span>
<span class="co">#&gt; dimension(s):</span>
<span class="co">#&gt;            from to  offset delta                refsys point   values x/y</span>
<span class="co">#&gt; x             1 50  325200   100 ETRS89 / TM35FIN(E,N) FALSE     NULL [x]</span>
<span class="co">#&gt; y             1 50 6824850  -100 ETRS89 / TM35FIN(E,N) FALSE     NULL [y]</span>
<span class="co">#&gt; percentile    1  2      NA    NA                    NA    NA 5% , 95%</span></code></pre></div>
<p>Visualizing different travel times at different percentile values clearly show the differences (note the different color scales in the different plots). The higher the percentile value, the higher the travel times. Note also how direct single-modal travel times become more prevalent at higher percentile values. These single-modal travel times are constant during the full time interval, and may at higher percentile values well be shorter than multi-modal travel times that are bound to transit schedules, especially if the transit services don’t operate at high frequency.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get 5th percentile values.</span>
<span class="va">p05_grid</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">prc_grid</span>, <span class="st">"percentile"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>

<span class="co"># Remove outliers for clearer visualization.</span>
<span class="va">p05_grid</span> <span class="op">=</span> <span class="fu">drop_outliers</span><span class="op">(</span><span class="va">p05_grid</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span><span class="va">bbox</span>, alpha.regions <span class="op">=</span> <span class="fl">0</span>, alpha <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span><span class="va">p05_grid</span>, layer.name <span class="op">=</span> <span class="st">"travel time (s)"</span>, na.color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span><span class="va">origin</span>, col.regions <span class="op">=</span> <span class="st">"black"</span>, alpha.regions <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0</span>, cex  <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-43c8842d285fd49e147d" style="width:672px;height:384px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-43c8842d285fd49e147d">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addPolygons","args":[[[[{"lng":[23.718250126641,23.8119475380217,23.8073542116148,23.713522385386,23.718250126641],"lat":[61.4727836102293,61.475009038068,61.5198256633383,61.5175961006981,61.4727836102293]}]]],null,"bbox",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":"#333333","weight":3,"opacity":1,"fill":true,"fillColor":"#6666ff","fillOpacity":0,"smoothFactor":1,"noClip":false},null,{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},"1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":5,"opacity":1,"fillOpacity":0,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[23.713522385386,61.4727836102293,23.8119475380217,61.5198256633383,true,"bbox","Zoom to bbox","<strong> bbox <\/strong>","bottomright"]},{"method":"addRasterImage","args":["data:image/png;base64,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",[[61.5198256633382,23.713522385386],[61.472299651963,23.8131118965579]],0.8,null,"travel time (s)","travel time (s)"]},{"method":"removeLayersControl","args":[]},{"method":"addControl","args":["","topright","imageValues-travel time (s)","info legend "]},{"method":"addImageQuery","args":["travel time (s)",[23.713522385386,61.4717972390467,23.8134734305333,61.5198256633382],"mousemove",7,"Layer"]},{"method":"addLegend","args":[{"colors":["#040404 , #0D0C23 3.78297288726769%, #5B1160 23.6834703997055%, #AE2075 43.5839679121433%, #EE5F46 63.4844654245811%, #F8B83C 83.3849629370189%, #FFFE9E "],"labels":["200","400","600","800","1,000"],"na_color":"#FFFFFF","na_label":"NA","opacity":1,"position":"topright","type":"numeric","title":"travel time (s)","extra":{"p_1":0.0378297288726769,"p_n":0.833849629370189},"layerId":null,"className":"info legend","group":"travel time (s)"}]},{"method":"addHomeButton","args":[23.713522385386,61.4727836102293,23.8119475380217,61.5198256633383,true,"travel time (s)","Zoom to travel time (s)","<strong> travel time (s) <\/strong>","bottomright"]},{"method":"createMapPane","args":["point",440]},{"method":"addCircleMarkers","args":[61.496725,23.761215,3,null,"origin",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"point","stroke":true,"color":"#333333","weight":1,"opacity":0,"fill":true,"fillColor":"black","fillOpacity":1},null,null,null,{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},"1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addHomeButton","args":[23.761215,61.496725,23.761215,61.496725,true,"origin","Zoom to origin","<strong> origin <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],["bbox","travel time (s)","origin"],{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addHomeButton","args":[23.713522385386,61.472299651963,23.8131118965579,61.5198256633383,true,null,"Zoom to full extent","<strong>Zoom full<\/strong>","bottomleft"]}],"limits":{"lat":[61.4727836102293,61.5198256633383],"lng":[23.713522385386,23.8119475380217]},"fitBounds":[61.472299651963,23.713522385386,61.5198256633383,23.8131118965579,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get 95th percentile values.</span>
<span class="va">p95_grid</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">prc_grid</span>, <span class="st">"percentile"</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>

<span class="co"># Remove outliers for clearer visualization.</span>
<span class="va">p95_grid</span> <span class="op">=</span> <span class="fu">drop_outliers</span><span class="op">(</span><span class="va">p95_grid</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span><span class="va">bbox</span>, alpha.regions <span class="op">=</span> <span class="fl">0</span>, alpha <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span><span class="va">p95_grid</span>, layer.name <span class="op">=</span> <span class="st">"travel time (s)"</span>, na.color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span><span class="va">origin</span>, col.regions <span class="op">=</span> <span class="st">"black"</span>, alpha.regions <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0</span>, cex  <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-5a5b0b5be4df7628e348" style="width:672px;height:384px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-5a5b0b5be4df7628e348">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addPolygons","args":[[[[{"lng":[23.718250126641,23.8119475380217,23.8073542116148,23.713522385386,23.718250126641],"lat":[61.4727836102293,61.475009038068,61.5198256633383,61.5175961006981,61.4727836102293]}]]],null,"bbox",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":"#333333","weight":3,"opacity":1,"fill":true,"fillColor":"#6666ff","fillOpacity":0,"smoothFactor":1,"noClip":false},null,{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},"1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":5,"opacity":1,"fillOpacity":0,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[23.713522385386,61.4727836102293,23.8119475380217,61.5198256633383,true,"bbox","Zoom to bbox","<strong> bbox <\/strong>","bottomright"]},{"method":"addRasterImage","args":["data:image/png;base64,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",[[61.5198256633382,23.713522385386],[61.472299651963,23.8131118965579]],0.8,null,"travel time (s)","travel time (s)"]},{"method":"removeLayersControl","args":[]},{"method":"addControl","args":["","topright","imageValues-travel time (s)","info legend "]},{"method":"addImageQuery","args":["travel time (s)",[23.713522385386,61.4717972390467,23.8134734305333,61.5198256633382],"mousemove",7,"Layer"]},{"method":"addLegend","args":[{"colors":["#040404 , #080917 1.96378499571489%, #2C1242 12.2943635081116%, #57125E 22.6249420205083%, #831070 32.955520532905%, #AD2075 43.2860990453017%, #D13D6A 53.6166775576984%, #EF6143 63.9472560700951%, #F69122 74.2778345824917%, #F8BD43 84.6084130948884%, #FBE87E 94.9389916072851%, #FFFE9E "],"labels":["200","400","600","800","1,000","1,200","1,400","1,600","1,800","2,000"],"na_color":"#FFFFFF","na_label":"NA","opacity":1,"position":"topright","type":"numeric","title":"travel time (s)","extra":{"p_1":0.0196378499571489,"p_n":0.949389916072852},"layerId":null,"className":"info legend","group":"travel time (s)"}]},{"method":"addHomeButton","args":[23.713522385386,61.4727836102293,23.8119475380217,61.5198256633383,true,"travel time (s)","Zoom to travel time (s)","<strong> travel time (s) <\/strong>","bottomright"]},{"method":"createMapPane","args":["point",440]},{"method":"addCircleMarkers","args":[61.496725,23.761215,3,null,"origin",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"point","stroke":true,"color":"#333333","weight":1,"opacity":0,"fill":true,"fillColor":"black","fillOpacity":1},null,null,null,{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},"1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addHomeButton","args":[23.761215,61.496725,23.761215,61.496725,true,"origin","Zoom to origin","<strong> origin <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],["bbox","travel time (s)","origin"],{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addHomeButton","args":[23.713522385386,61.472299651963,23.8131118965579,61.5198256633383,true,null,"Zoom to full extent","<strong>Zoom full<\/strong>","bottomleft"]}],"limits":{"lat":[61.4727836102293,61.5198256633383],"lng":[23.713522385386,23.8119475380217]},"fitBounds":[61.472299651963,23.713522385386,61.5198256633383,23.8131118965579,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script><p>Results will look different if we for example restrict access trips to be done by foot, limit both access and egress trips to be maximum 5 minutes, and don’t include direct trips at all.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all</span> <span class="op">=</span> <span class="fu"><a href="../../reference/multinet_traveltimes.html">multinet_traveltimes</a></span><span class="op">(</span>
  <span class="va">tampere</span>,
  <span class="va">origin</span>,
  <span class="va">time</span>,
  day <span class="op">=</span> <span class="va">day</span>,
  access_modes <span class="op">=</span> <span class="st">"walk"</span>,
  direct_modes <span class="op">=</span> <span class="cn">NA</span>,
  egress_modes <span class="op">=</span> <span class="st">"walk"</span>,
  access_limit <span class="op">=</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">60</span>,
  egress_limit <span class="op">=</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">60</span>,
  iterate <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="va">all_grid</span> <span class="op">=</span> <span class="fu"><a href="../../reference/create_traveltime_grid.html">create_traveltime_grid</a></span><span class="op">(</span><span class="va">all</span>, <span class="va">grid</span><span class="op">)</span>
<span class="va">prc_grid</span> <span class="op">=</span> <span class="fu"><a href="../../reference/reduce_to_percentiles.html">reduce_to_percentiles</a></span><span class="op">(</span><span class="va">all_grid</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">95</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get 5th percentile values.</span>
<span class="va">p05_grid</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">prc_grid</span>, <span class="st">"percentile"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>

<span class="co"># Remove outliers for clearer visualization.</span>
<span class="va">p05_grid</span> <span class="op">=</span> <span class="fu">drop_outliers</span><span class="op">(</span><span class="va">p05_grid</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span><span class="va">bbox</span>, alpha.regions <span class="op">=</span> <span class="fl">0</span>, alpha <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span><span class="va">p05_grid</span>, layer.name <span class="op">=</span> <span class="st">"travel time (s)"</span>, na.color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span><span class="va">origin</span>, col.regions <span class="op">=</span> <span class="st">"black"</span>, alpha.regions <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0</span>, cex  <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-c584f36a18798e3c9a43" style="width:672px;height:384px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-c584f36a18798e3c9a43">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addPolygons","args":[[[[{"lng":[23.718250126641,23.8119475380217,23.8073542116148,23.713522385386,23.718250126641],"lat":[61.4727836102293,61.475009038068,61.5198256633383,61.5175961006981,61.4727836102293]}]]],null,"bbox",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":"#333333","weight":3,"opacity":1,"fill":true,"fillColor":"#6666ff","fillOpacity":0,"smoothFactor":1,"noClip":false},null,{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},"1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":5,"opacity":1,"fillOpacity":0,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[23.713522385386,61.4727836102293,23.8119475380217,61.5198256633383,true,"bbox","Zoom to bbox","<strong> bbox <\/strong>","bottomright"]},{"method":"addRasterImage","args":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADUAAAA1CAYAAADh5qNwAAAQiElEQVRoge2aeZhddXnHP7+z3HPuPXeduXcmM5N9JQsJYRMCokIB26p9sPLgwqOgtkBl0SakllYfrdY+BngoImpdKOICVEoFFQUBKSqkyhogIYSQZTKZyZ25+3ruuee8/eMkM6YDLVFC2j6+z3Of587M77y/93ve/X1HiQj/30g70gIcDvo9qP8r9HtQrwd1njr/d45c/ytAte84RgDce08TggD38fPEffw8Aeg88d5DBqmOZEhv/+gkoVJFCi6YIG3Q+m3wA4jZqBmzAbDW3KUOhe+R1VSziZRcpK4jJR1aOlJz9/+tjZT2oVLZQ2Z7REHZ525SUtXBDKak0fcrRddQRoTI8m9Maskb/qtXZVZHzPza3z9OZKJCsNuGYMq6tJlN1Kwcyohgnf2wch/5E1G2gzTKoJtg2ahkjsiiL76iSR5RnwJo37pcur+KhcKkGjif2qwA3F+fK2ga8tIWiMXAdVF2FOJJVLyHyLHfPfKg2nccIzTb+LvA+cTzkwK1rl8gakaM7kYb46Q2km+iZjhoi1YS7NyCFKooywgPWyZELJRpQk8/2oz5mHOvVd7IVWIOfW6S5+sKyt/SJsinUYY/+XstW0VcE6lFUVEXbaCBdswSqJUJ9uRDIS099LFcDsxI+PG7kzxUMovKzcKc9XkFYABsPv1i8TyDTG+FZM8Y6Zt+ekgh9NWQ/a6nFEDtolNFZStIOY5KNVC9XVqPLMJtOSR6RtBXgxTHkfHS1MO6BqkkZHJoM+YjxVEApJyHSBTptKBWnDxuAFSrNgAZOCyA6muPk/i1j6v8e94p3e4Q6aWjSKtDZ9csgpdM3JYDgNvoQf2ig8pW0XoE8UDFQnGUk0Als5izr1aE6Qt34zmCpoFuoGxn8j4N4KTH/lElEi7FiTQAW8+8SDad9pFXZZf1dccedO663rUH/Vz/+CqRepQdf3yhuO0YIhrBjl7wDMxk6SBe5UIOt9SHFBNIOfQjaQrihqYm5fxB51XPDKwT/1VZx92uMK2DQX1//npZ/rMvK8dp8fQbL5XhkQQTxeg0AHctWC/3LL5yUuj7l62TbrGX+hUnyp3z1gvArqDFZzMfk8anlwqA8cYojfIAnmfSasRoNWJ41Qz60granCKmVUNEo15JEfg6xX0zaOWH8PdMJV3V1wNmBOukf5vKWTvXSvee+6hdcorUP75KOjffNXVeRHjo6LWyu6Dz/r0b1HNvuUTG8g6tjmIo1ybTW2PuD25W9y29UlodxXhdcCKKRkdIWgpDhyfLLp8pXa+uylwuTbpYaOQ0iw+941mi76pQvHkO9UoKAN/XyE84tF2NqO1z9OrnqJdztBoxqtUoyWSL3NAuIkN7UdkmygRt4RDW2Q+rzrZLRZkW5txrFUD+Pe+UvlvvVBPnv0MC36Dv1junAkUm7TI40OGmGetFqQTHzGsxMm4zMm6z+pEbFITl2L660PKFRktImhrRCDxZ6JDSDK7KXC5jqoklOhXlogcaN9+9gnMmCjQbNp2OSbFskXA8mm2NSlNhmQpr8Q7G7p9HoxGaT61mw8gcnFoPQ3fcqtp3HCMkMngjV0njc9vQdI/SvgukWnGw7Sx9QMc92Ko0gDmLttKoW8zMCPEIbN4dJW4HRCPCL4/9mGw986JJk5sZ1zhtsctRgx6JqM+qnghz4jo6oWW0VRdX+cTQsXWNUiFBs2kxUbQIAtgybFFsKJoejFd1gkqUntwEiUSbRsvAMAJ0o4sdq+Hee5qoniy7P51j7NLdxD+xlHJ+JtWKQ7qniu+HVd7g925X00B1WgkWn/UAb751lPmDbaIm7CronPHcNSqdarPkp/+kdA1ihqLShrGCTaFq8OReSMV8ZuU6WGh08GkqDw+fIh3ynsdFL2xn7Yu7uH/U5a7RBnP7utQ7ghsIpbZwz3fPZtvW2QyPJCjXdZx4i5G9aXpv+aEa/eJ89n1hgEIhzshwlp2X1DEtl3RPlVYjRiJVpfLh0wUgnh472KeKH/hDAbCGRth07xkMj5tMtELlZKOKRDT8/mJBaAUBKUOn0O1SEY8390X5dd5jhCYTWpPQpjVGVJkGbcpBjV4tjYOFicEKv4+81mRRkCIAVqct4rZQbijKrtDnKFoe9KcCTn/2GnUgIDlRn97eBgNLNlEbmwNAcnAH8et/pQAanzlKDlQqSkQYPud8USogs/Ip6Bjc/a23UusI3f3FsydC5TcyeEzTeUFqmKIRx8AloKo6dPBpKY+yatLGo00HgLxfJK0l0VVoLn2kyUiUuUGSnGYxENWpuMLsNJSbimpHyMUUuaRP11ekkx6xmEu6tzTN1F6OQvNzI3iuhfOpzaqbzzI759HnhM+mLMX8tIa1X6CYpjMatEOwKqCkOhRUm1GtRmG/pgrUGA72MdwdZbg7iisu+/xxikEFXwIatOkSsEur4YlgahA3FbvLUPOEuKmI24JpBmga9PZWceJNBr93u/qvedHdeM60fKpEhCfXXCZ+oDFnwS7cVoyZd35X/fuqMIke/857uOemt+NYwq4y2Lpid7tDBQ8dhYvPqFanrjqTTC3RKakmeSlT8MPyJV/epJb0niYACeXQEpcFzOC9sZksndtky84Yrg8KSNqQjAU0XcXbtl2t7lt6pYxWFCkbohHhLbeN8ugH+nGiXWzbY8VDX1LTQD120hWTaI/feL0C2Hb2h8UwfJpNm1I5yonfqRFZ9jV157z1srPqMxK0iWHQwaekOlii86JepDeI0VQd/qJ/gL/Pb8fDZ3cwxjxtkKLU6OBhhJmEK4zjMJTCDYRuINQCn3mOSSDQ8gRTV6SjsL3sYyqFY2ik7LAUjBhCIDCUa6MbAabps/SBr0zlqd7eKo1GlFSmCoQF7kvDGRbMrgEwPGFw6rKvKYBsqotj6TBuM9PReabmkhATj4BlfhYBTkvnMHSfG1f285FN+0ioOF18siqJhmJMyvSpFF/3nyNHkguc2TxabdKvLJ6vuzTx6VERdA/G2uBK6NytQKMrOiLgC+RiivGSjRPtomtTVqhEhL3nnifjYznKVYtac6rDr7WntGoZkIoFVJoaXR9KbSFjK7bXu/SaOtmYQlPQ8uCEFQW8jsmcsx8gtn7bJJPzey6U7do4JjoKxYCkuK3wTXVl5lIB8BF6iNDEZ9CIoKGY6HoMRkxm94Q8NuUD1hWuVV/KXSkZW2HsF3ew1+OUJ65TsD9QDH7vdpVMNujNtIhZchCQ9wxvULlEgKlDoaYxVhcmWkInEEabweSQQwT6Mx5REybGEyQzFdj/9hp/e/QkUxsTHQ0DjRmBww3ZdWKjE0Nn/Vl5HE1j0IhwwXsfpt9R5EyTnpii3lacteVqta4QlkirZnUptYWaC5oCz5tSxrQm8ck1l0nE6jI+EcOKBJz8+HVq4/EflWLVZF8t1Ibrh+He2//srISGrkFf2qNQNUjHfZyox6I1vwRRFLYtZ/tLfWzNK57yKjRVl1Gtygq/j6veOsaPHlpIqeOTiei878d7Gf2khpMs8+Lz81m07EUefXQpbzhxG+1mHBHFyHCWTlejUNUpt/YDUXDh6Ab1sqAAXjjrz6VWs9GUsPqRG9Rzb7lElv/sy+r+Zeuk0tRIOwEi8MK4ImMroiaccvILjI/OoFgK5w3JhEtPtoSTKlDcNwTA2FiK+3cIjqbzGBMkxSIjEQZ1m6SpYRuQigqZRJdqw6DeVrS7Yd3ZnxRScY+hWRNErDClPL9lDqWaTjHMJHxw7L8B9T/RgyvWia4Lb3r62kl/eWD5Olm4IE9xIkXE6mKaPhGrQ3bJJlS8TTCe4pv/cgo1P2BcXMZV+IqjGJxqp5lwfQZiOp4PER3qnbAb8Hww9TDUp2JCNt1h1ty9OH3DqKhLZ98Mtj57FLvyJkLoLq/pjGLfu98lo3sGSGfCduXlznwic4XkadFUUxXKmXaWna0wz1lKw9Y0IpqiL6ZodOD9ezdM8vrhorCfy6Y8dF2Ix12G5m+hWe1jz65Bjt94vXpNh5n9t92hZs3f8YqA2t9cIgml89endvhW8Sa1UJJ8q3iTGmt3p53VgEobbANuGVwvDyxfJwBnfuclACYqJm5HB6A4Ng/fN7BtD3gdp0k/XnKlFBuK9+3ZoK7MXCoTqkWfRPl8KRxKXte7VmbGdSZaMjmkBUhboV/1OELcDpg1q0St6nDML25QT7/xUgl8RaNlAmBFfE74j+uVcTiB/GDhemm4UO0Iw50OK5MW1/WulYwymanZnLmyPnnWMTRKbSFtKfwAvCDUUrsbVhBNV5GOCzt29hC1fTaffrGs+vlX1ObTL5YDoA5o7rCAenLNZdJomXi+QasbZn8f4bFqEweDxfEI7x7ecJCJZmOKY1fk6bgRnt6aJq5D3Q2DRF8yoNVRlOuh0G3PwLYi7Hz7BbLswemmflhA1ZomxaqB2wU/EKpdH58AG50OAcX2lMk/ueYyKVUtzjjjCdr1HrrdFCcft4fNW4aIRsDzwYoEpBI+Y4UIMUtouopOR2fg0pde9v7DsvUwdaEV+iwBoCtFTrNIawazTIuUpfjOzHD6tPqRG9TOCY0tT62k/7Y7VDxZpVmPM3dWhXmzK/T3dMikWxhGwMz+9uQdfqDY+4UFrx8owwgwtHArU+0GtIPwYyhFPKJIRYX37TnY/Jptg8dPvlyc7B56+saIOk2iTpOh2WGb3psrkUrVidldIvvty/NM3J+cOi3SveagHj/5colEfHriAR1/6gJb08hFNXoc4W3brp7mB7WWRqNlQFfHcorE0+PoRqjuTLZIvRqnWg2nsJlkhxkzKmQHhkE3pg1UX3NQxz36BbXq519Uud4WqSikTZ2EHjq468Oqlbspf/DMaW+3L+1Rqb+yi+t6gFLhY76vqNdiBL5J+/YQQuOqldK8ZqEcFlAHaOXDN6q6C4EIvghDMR1Lh/QJT0yb16dssK0ub39xgyJycCLWtID0CU+w+L6vqpUP36gAYjEPy/LI7x2knJ+JPq+CdAxam44CDlP0O0C5RECqq/DKYQ7KxdRB/RWEdeSf7rxGtb6xSJr/sFi0lIXz2WcUhAuL6p+9SRBF5cOni9eOk0wOAmGrc4Dy955C1JnKeYd157vmg9/H0MExQhx+MP3MgTFY9EPblEqGe6vmNQulfedqAdAHCgCkvv6gyn77bpXtn1oSZPvzzLn7FqXpIWPdDOvHw14mPXT0Wqm3NeptxUCPz7FrNqIv2Eds3Yuq8ckV4vzds+E69CeniuwbJyh1USmd6IUvTAsm9StOFL8RJ/X1BxVA6cKzJTIwGjajhg9dHeezzxzeMgngzc+E7cldC9ZLxAjwmkncp3qJAUEpPnVQN8J6CF4W0AE6AAgg88/3Tq1Zb1gg0cu2//b91KHQL1b/pTTbeli7OT6aLqw89hn8brgQsOfuxPm7Z1X7B28QgoBgRzhSi310u3I3niO/ub55tXTYNLX59IslP+7gejp7Kwfk0onbAZFFu2htWUzvLT+cWj7rOlKqhN9TYQqgUfmt7n7FQNG6ccHvpMJlD35FdboabU9h7391EUNYc8Fd+Ht6sTKhw+899zxxHzpLrD96RKm5c1EpHZVJ4D78VrHOePCQtQQvY36try4UXEGqBrG/2XrITFvfWCQvffsPWP6zL7/mu+NXS0f8n0MOB/0nol+RcSs7P8gAAAAASUVORK5CYII=",[[61.5198256633382,23.713522385386],[61.472299651963,23.8131118965579]],0.8,null,"travel time (s)","travel time (s)"]},{"method":"removeLayersControl","args":[]},{"method":"addControl","args":["","topright","imageValues-travel time (s)","info legend "]},{"method":"addImageQuery","args":["travel time (s)",[23.713522385386,61.4717972390467,23.8134734305333,61.5198256633382],"mousemove",7,"Layer"]},{"method":"addLegend","args":[{"colors":["#040404 , #23123B 9.94261815644822%, #691066 26.7918178194642%, #AE2075 43.6410174824802%, #E65555 60.4902171454962%, #F69E25 77.3394168085122%, #FAE57A 94.1886164715283%, #FFFE9E "],"labels":["400","600","800","1,000","1,200","1,400"],"na_color":"#FFFFFF","na_label":"NA","opacity":1,"position":"topright","type":"numeric","title":"travel time (s)","extra":{"p_1":0.0994261815644822,"p_n":0.941886164715283},"layerId":null,"className":"info legend","group":"travel time (s)"}]},{"method":"addHomeButton","args":[23.713522385386,61.4727836102293,23.8119475380217,61.5198256633383,true,"travel time (s)","Zoom to travel time (s)","<strong> travel time (s) <\/strong>","bottomright"]},{"method":"createMapPane","args":["point",440]},{"method":"addCircleMarkers","args":[61.496725,23.761215,3,null,"origin",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"point","stroke":true,"color":"#333333","weight":1,"opacity":0,"fill":true,"fillColor":"black","fillOpacity":1},null,null,null,{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},"1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addHomeButton","args":[23.761215,61.496725,23.761215,61.496725,true,"origin","Zoom to origin","<strong> origin <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],["bbox","travel time (s)","origin"],{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addHomeButton","args":[23.713522385386,61.472299651963,23.8131118965579,61.5198256633383,true,null,"Zoom to full extent","<strong>Zoom full<\/strong>","bottomleft"]}],"limits":{"lat":[61.4727836102293,61.5198256633383],"lng":[23.713522385386,23.8119475380217]},"fitBounds":[61.472299651963,23.713522385386,61.5198256633383,23.8131118965579,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get 95th percentile values.</span>
<span class="va">p95_grid</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">prc_grid</span>, <span class="st">"percentile"</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>

<span class="co"># Remove outliers for clearer visualization.</span>
<span class="va">p95_grid</span> <span class="op">=</span> <span class="fu">drop_outliers</span><span class="op">(</span><span class="va">p95_grid</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span><span class="va">bbox</span>, alpha.regions <span class="op">=</span> <span class="fl">0</span>, alpha <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span><span class="va">p95_grid</span>, layer.name <span class="op">=</span> <span class="st">"travel time (s)"</span>, na.color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span><span class="va">origin</span>, col.regions <span class="op">=</span> <span class="st">"black"</span>, alpha.regions <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0</span>, cex  <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-82898744f9b7411c2ec7" style="width:672px;height:384px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-82898744f9b7411c2ec7">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addPolygons","args":[[[[{"lng":[23.718250126641,23.8119475380217,23.8073542116148,23.713522385386,23.718250126641],"lat":[61.4727836102293,61.475009038068,61.5198256633383,61.5175961006981,61.4727836102293]}]]],null,"bbox",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":"#333333","weight":3,"opacity":1,"fill":true,"fillColor":"#6666ff","fillOpacity":0,"smoothFactor":1,"noClip":false},null,{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},"1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":5,"opacity":1,"fillOpacity":0,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[23.713522385386,61.4727836102293,23.8119475380217,61.5198256633383,true,"bbox","Zoom to bbox","<strong> bbox <\/strong>","bottomright"]},{"method":"addRasterImage","args":["data:image/png;base64,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",[[61.5198256633382,23.713522385386],[61.472299651963,23.8131118965579]],0.8,null,"travel time (s)","travel time (s)"]},{"method":"removeLayersControl","args":[]},{"method":"addControl","args":["","topright","imageValues-travel time (s)","info legend "]},{"method":"addImageQuery","args":["travel time (s)",[23.713522385386,61.4717972390467,23.8134734305333,61.5198256633382],"mousemove",7,"Layer"]},{"method":"addLegend","args":[{"colors":["#040404 , #1D1135 8.16550103060076%, #691067 26.8920927909004%, #B52574 45.6186845512%, #F06340 64.3452763114996%, #F8B73B 83.0718680717993%, #FFFE9E "],"labels":["500","1,000","1,500","2,000","2,500"],"na_color":"#FFFFFF","na_label":"NA","opacity":1,"position":"topright","type":"numeric","title":"travel time (s)","extra":{"p_1":0.0816550103060076,"p_n":0.830718680717993},"layerId":null,"className":"info legend","group":"travel time (s)"}]},{"method":"addHomeButton","args":[23.713522385386,61.4727836102293,23.8119475380217,61.5198256633383,true,"travel time (s)","Zoom to travel time (s)","<strong> travel time (s) <\/strong>","bottomright"]},{"method":"createMapPane","args":["point",440]},{"method":"addCircleMarkers","args":[61.496725,23.761215,3,null,"origin",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"point","stroke":true,"color":"#333333","weight":1,"opacity":0,"fill":true,"fillColor":"black","fillOpacity":1},null,null,null,{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},"1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addHomeButton","args":[23.761215,61.496725,23.761215,61.496725,true,"origin","Zoom to origin","<strong> origin <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],["bbox","travel time (s)","origin"],{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addHomeButton","args":[23.713522385386,61.472299651963,23.8131118965579,61.5198256633383,true,null,"Zoom to full extent","<strong>Zoom full<\/strong>","bottomleft"]}],"limits":{"lat":[61.4727836102293,61.5198256633383],"lng":[23.713522385386,23.8119475380217]},"fitBounds":[61.472299651963,23.713522385386,61.5198256633383,23.8131118965579,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Lucas van der Meer.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
